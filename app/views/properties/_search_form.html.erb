<%= form_with url: properties_path, method: :get, local: true, data: { controller: "search", turbo_frame: "properties" } do |form| %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <!-- Search Input -->
    <div>
      <%= form.label :search, "Keywords", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.text_field :search, value: params[:search],
                         placeholder: "Address, city, features...",
                         class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>

    <!-- Property Type -->
    <div>
      <%= form.label :property_type, "Type", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :property_type,
                     options_for_select([["Any Type", ""]] + Property.property_types.keys.map { |k| [k.humanize, k] }, params[:property_type]),
                     {},
                     class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>

    <!-- Price Range -->
    <div>
      <%= form.label :min_price, "Min Price", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.number_field :min_price, value: params[:min_price],
                           placeholder: "Min price",
                           class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>

    <div>
      <%= form.label :max_price, "Max Price", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.number_field :max_price, value: params[:max_price],
                           placeholder: "Max price",
                           class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>
  </div>

  <!-- Advanced Filters (Collapsible) -->
  <div class="mb-6">
    <button type="button"
            data-action="click->search#toggleAdvanced"
            class="flex items-center text-sm text-indigo-600 hover:text-indigo-800 mb-3">
      <span>Advanced Filters</span>
      <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
      </svg>
    </button>

    <div data-search-target="advanced" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4 bg-gray-50 rounded-lg">
      <!-- Bedrooms -->
      <div>
        <%= form.label :min_bedrooms, "Min Bedrooms", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :min_bedrooms,
                       options_for_select([["Any", ""], ["1+", 1], ["2+", 2], ["3+", 3], ["4+", 4], ["5+", 5]], params[:min_bedrooms]),
                       {},
                       class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>

      <!-- Bathrooms -->
      <div>
        <%= form.label :min_bathrooms, "Min Bathrooms", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :min_bathrooms,
                       options_for_select([["Any", ""], ["1+", 1], ["2+", 2], ["3+", 3]], params[:min_bathrooms]),
                       {},
                       class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>

      <!-- Square Feet -->
      <div>
        <%= form.label :min_sqft, "Min Size (sqft)", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.number_field :min_sqft, value: params[:min_sqft],
                             placeholder: "Min square feet",
                             class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>

      <!-- Availability -->
      <div>
        <%= form.label :available_by, "Available By", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.date_field :available_by, value: params[:available_by],
                           class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>

      <!-- Amenities -->
      <div>
        <%= form.label :furnished, "Furnished", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :furnished,
                       options_for_select([["Any", ""], ["Furnished", "true"], ["Unfurnished", "false"]], params[:furnished]),
                       {},
                       class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>

      <div>
        <%= form.label :pets_allowed, "Pets Allowed", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= form.select :pets_allowed,
                       options_for_select([["Any", ""], ["Yes", "true"], ["No", "false"]], params[:pets_allowed]),
                       {},
                       class: "w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex flex-wrap gap-4">
    <%= form.submit "Search", class: "btn btn-primary" %>
    <%= link_to "Reset", properties_path, class: "btn btn-secondary" %>
    <%= link_to "Map View", properties_path(view: 'map', **request.query_parameters), class: "btn btn-secondary" %>

    <!-- Sort Dropdown -->
    <div class="relative">
      <%= form.select :sort,
                     options_for_select([
                       ["Newest", "newest"],
                       ["Price: Low to High", "price_low_high"],
                       ["Price: High to Low", "price_high_low"],
                       ["Most Bedrooms", "bedrooms"],
                       ["Largest", "size"]
                     ], params[:sort]),
                     {},
                     class: "btn btn-secondary pr-8",
                     data: { action: "change->search#submit" } %>
    </div>
  </div>
<% end %>
